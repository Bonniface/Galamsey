---
title: "Classification and Quantifying Of Change In Land Use With Time Series In Ghana"
author: "Kalong Boniface 
         "
date: '`r Sys.Date()`'
output: html_document
toc: true
toc_depth: 2
number_sections: true
fig_width: 7
fig_height: 6
fig_caption: true
df_print: kable
fontsize: 12pt
template: quarterly-report.tex
header-includes:
  - \setmainfont{Times New Roman}
editor_options: 
  markdown: 
    wrap: 72
bibliography: References.bib
link-citations: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(cptcity)
library(rgdal)
library(raster)
library(stars)
library(rgee)
library(sf)
library(reticulate)
library(bookdown)


```

[**Quantifying the Status of Galamsey In Ghana With Time Series
Classification**]{.ul}

**Introduction**

    The purpose of this paper is to establish an understanding of time

series analysis on remotely sensed data. Which will introduced us to the
fundamentals of time series modeling, including decomposition,
autocorrelation and modeling historical changes in Galamsey Operation in
Ghana, the Cause,Dangers and it's Environmental Impact.

    Galamsey("gather them and sell")\\parencite{OwusuNimo2018}, is the term

given by local Ghanaian for illegal small-scale gold mining in
Ghana\\parencite{DavidYawDanquah2019}.

    The major cause of Galamsey is unemployment among the youth in

Ghana\\parencite{Gracia2018}. Young university graduates rarely find
work, and when they do it hardly sustains them. The result is that these
youth go the extra mile to earn a living for themselves and their
family. Another factor is that lack of job security.

    On November 13, 2009 a collapse occurred in an illegal, privately owned

mine in Dompoase, in the Ashanti Region of Ghana. At least 18 workers
were killed, including 13 women, who worked as porters for the miners.
Officials described the disaster as the worst mine collapse in Ghanaian
history\\parencite{News2009}.

    Illegal mining damages the land and water supply\\parencite{Ansah2017}.

In March 2017, the Minister of Lands and Natural Resources,\\textbf{ Mr.
John Peter Amewu}, gave the galamsey operators/illegal miners a
three-week ultimatum to stop their activities or be prepared to face the
law\\parencite{Allotey2017}. The activities by galamseyers have depleted
Ghana's forest cover and they have caused water pollution, due to the
crude and unregulated nature of the mining
process\\parencite{Gyekye2021}.

Under current Ghanaian constitution, it is illegal to operate as
galamseyer.That is to dig on land granted to mining companies as
concessions or licenses and any other land in search for gold. In some
cases, Galamseyers are the first to discover and work extensive gold
deposits before mining companies find out and take over. Galamseyers are
the main indicator of the presence of gold in free metallic dust form or
they process oxide or sulfide gold ore using liquid mercury.

    Between 20,000 to 50,000, including thousands from China are believed

to be engaged in Galamsey in Ghana.But according to the Information
Minister 200,000 and nearly 3 million people, recently are now into
Galamsey operation and rely on it for their
livelihoods\\parencite{Burrows2017}.Their operations are mostly in the
southern part of Ghana where it is believe to have substantial reserves
of gold deposits, usually within the area of large mining
companies\\parencite{Barenblitt2021}. As a group, they are economically
disadvantaged. Galamsey settlements are usually poorer than neighboring
agricultural villages. They have high rates of accidents and are exposed
to mercury poisoning from their crude processing methods. Many women are
among the workers, acting mostly as porters for the miners.

**Problem Statement**

The Footprint of Galamsey is Spreading at a much faster rate.

**Objectives**

The purpose is to establish an understanding in time series analysis on
remotely sensed data. We will be introduced to the fundamentals of time
series modeling, including decomposition, autocorrelation and modeling
historical changes.

-   Perform time series analysis on satellite derived vegetation indices

-   Gain familiarity with R Markdown, Reticulate and the R Spatial
    Ecosystem

-   Process satellite imagery using the Google Earth Engine API

-   Create a Statistical interactive dashboard

**Data collection and Methodology**

**Data**

As Galamsey is considered an illegal activity, they operations are
hibben to the eyes of the authorities.So locating them is quite tricky
,but with satellite imagery ,it now possible to locate their operating
and put an end to it. One of the features of Google Earth Engine is the
ability to access years of satellite imagery without needing to
download, organize, store and process this information. For instance,
within the Satellite image collection,now it possible to access imagery
back to the '90s, allowing us to look at areas of interest on the map to
visualize and quantify how much things has changed over time. With Earth
Engine, Google maintains the data and offers it's computing power for
processing.Users can now access hundreds of time series images and
analyze changes across decades using ***GIS and R*** or another
programming language to analyze these datasets.

**Method**

Time series data is the collection of observations made sequentially at
different points in time.Because data points in time series are
collected at adjacent time periods there is potential for correlation
between observations. we propose some new tools to allow machine
learning classifiers to cope with time series data.\\emph{ We first
argue that, time-series classification problems can be solved by
detecting and combining local properties or patterns in time series}.
Then, a technique is proposed to find patterns which are useful for
classification. These patterns are combined to build interpretable
classification rules.

-   

          First, we will pull Sentinel 2 to select NDVI and EVI data from

    Google Earth Engine, applying a quality filter to mask poor quality
    pixels.

-   

          Instead of performing our analysis on the imagery itself, we will

    be summarizing the mean NDVI and EVI value , this will allow the
    analysis to take less time while producing a visually appealing and
    informative map.

-   

          Some cells may not contain NDVI and EVI for a given month, to

    correct this, we will apply smoothing method using an ARIMA
    function.

-   

          Once NA values are remove, we will decompose the time series to

    remove seasonality and fit a linear model to the normalized data.

-   

          Once we have extracted the linear trend, we will then make a move

    to classifier our data on the map and map it.

**Significance Of the Study**

**Limitations**

Time series modeling aims to build an explanatory model of the data
without over fitting the problem set, to use as simple a model as
possible while accounting for as much of the data as possible. When
breaking down time series data into component parts, remote sensing data
has additional limitations that make this more challenging. It is almost
inevitable that you will not get this same level of precision from
remote sensing data. Additionally, atmospheric conditions can skew the
visual results, where the hue of the vegetation changes drastically from
image to image due to atmospheric conditions such as (fog, ground
moisture, cloud cover).

```{r}
ee_Initialize()
```

\newpage

**Area Of Interest**

The first step in analysis of time series data is to import data of
interest and plot the data around our region of interest, a deciduous
forest .

```{r,message=FALSE}
fc <- ee$FeatureCollection(list(
  ee$Feature(
    ee$Geometry$Polygon(
      list(
        c(-2.071165253017948, 6.147184753446289),
        c(-2.071165253017948, 5.834419008815262),
        c(-1.462797333096073, 5.834419008815262),
        c(-1.462797333096073, 6.147184753446289)
      )
    ),
    list(name = "Ghana", fill = 1)
  ),
  ee$Feature(
    ee$Geometry$Polygon(
      list(
        c(-2.071165253017948, 6.147184753446289),
        c(-2.071165253017948, 5.834419008815262),
        c(-1.462797333096073, 5.834419008815262),
        c(-1.462797333096073, 6.147184753446289)
      )
    ),
    list(name = "Utah", fill = 2)
  )
))
 


modis_ndvi <- ee$ImageCollection("MODIS/006/MOD13A1")
```

\\

```{r ,include=FALSE}
getQABits <- function(image, qa) {
  # Convert binary (character) to decimal (little endian)
  qa <- sum(2^(which(rev(unlist(strsplit(as.character(qa), "")) == 1))-1))
  # Return a mask band image, giving the qa value.
  image$bitwiseAnd(qa)$lt(1)
}


mod13Q2_clean <- function(img) {
  # Extract the NDVI band
  ndvi_values <- img$select("NDVI")
  evi_values <- img$select("EVI")
  # Extract the quality band
  ndvi_qa <- img$select("SummaryQA")
  
  # Select pixels to mask
  quality_mask <- getQABits(ndvi_qa, "11")
  
  # Mask pixels with value zero.
  ndvi_values$updateMask(quality_mask)
}

ndvi_composite <- modis_ndvi$
  filter(ee$Filter$date('2001-01-01', '2019-12-31'))$
  filter(ee$Filter$calendarRange(1, field = "month"))$
  map(mod13Q2_clean)$
  median()


scale <- 0.0001
Map$setCenter(lon = -2.063,lat = 6.088,zoom = 6)
Map$addLayer(
  eeObject = ndvi_composite, 
  visParams = list(
    min = 0.2 / scale, 
    max = 0.7 / scale,
    palette = cpt("grass_ndvi", 10)
  )
) + Map$addLayer(fc)

mod_ndvi <- ee_as_raster(
  image = ndvi_composite,
  region = fc$geometry(),
  scale = 1000,
  via = 'drive'
)
  


if(readline(prompt = " Hit enter to proceed or type 'no' to download the data. ") == "no")
googledrive::drive_download(file = googledrive::as_id("https://drive.google.com/file/d/1w-vVSviHaakKx8pP0Eio98zGp-xjDCXV/view?usp=sharing"), overwrite = T)
evi.df <- read.csv("rgee_file_49c16316a86_2022_04_24_09_08_29.csv")
evi.df <- evi.df[,3:ncol(evi.df)]
colnames(evi.df) <- c('hex_id', stringr::str_replace_all(substr(colnames(evi.df[, 2:ncol(evi.df)]), 2, 11), "_", "-")) #Convert dates to unambiguous format


library(lubridate)
evi.hw.lst <- list() #Create an empty list, this will be used to house the time series projections for each cell. 
evi.dcmp.lst <- list() #Create an empty list, this will be used to house the time series decomposition for each cell.
evi.trend <- data.frame(hex_id = evi.df$hex_id, na.cnt = NA, na.cnt.2 = NA, trend = NA, p.val = NA, r2 = NA, std.er = NA, trnd.strngth = NA, seas.strngth = NA) #This data frame will hold the trend data
Dates <- data.frame(date = seq(as.Date('2001-01-01'), as.Date('2019-11-01'), "month"))
Dates$month <- month(Dates$date)
Dates$year <- year(Dates$date)
i <- 1

```

```{r}

```

```{tsv <- data.frame(evi = t(evi.df[i, 2:ncol(evi.df)])) #converting the data to a transposed data frame}
colnames(tsv) <- c("evi")
head(tsv) #let's take a look
```

Data preparation and Preprocessing

We begin by loading in the Landsat 8 collection and provide a point at
the region of interest. Additionally, we will create a time field.

# EDA

```{r, message=FALSE}
visdat::vis_miss(tsv)
```

```{r}
library(skimr)
skimr::skim(tsv)

```

Time series data is data that is collected at different points in time.
This is opposed to cross-sectional data which observes individuals,
companies, etc. at a single point in time.

Because data points in time series are collected at adjacent time
periods there is potential for correlation between observations. This is
one of the features that distinguishes time series data from
cross-sectional data. \\section("Example Of Time Series") - Discrete
Time Series - Continuous Time Series

```{r}


na.cnt <- length(tsv[is.na(tsv)]) #We want to get an idea of the number of entries with no EVI value
evi.trend$na.cnt[i] <- na.cnt
td <- tsv %>%
  mutate(month = month(as.Date(rownames(tsv))), year = year(as.Date(rownames(tsv)))) %>% 
  group_by(year, month,evi) %>%
  summarise(mean_evi = mean(evi, na.rm = T), .groups = "keep") %>%
  as.data.frame()

td1 <- tsv %>%
  mutate(evi=evi)%>%
 # mutate(month = month(as.Date(rownames(tsv))), year = year(as.Date(rownames(tsv)))) %>% 
  #group_by(year, month) %>%
  as.data.frame()

ts1 <- ts(data = td1$evi, start = c(2001, 1), end = c(2019, 11), frequency = 12) #convert data to time series.
plot(ts1)
```

## Components Of A Time Series

Classical decomposition is the term use to describe the four main
element that time series could be specified under.

1.  Trend Variation

2.  \- Seasonal Variation

3.  -Cyclical Variation

4.  -Irregular or Residual Variation

In addition to containing a non-zero mean, time series data may also
have a deterministic component that is proportionate to the time period.
When this occurs, the time series data is said to have a time trend.

**Trends** in time series data also have implications for testing and
modeling. The reliability of a time series model depends on properly
identifying and accounting for time trends.

A time series plot which looks like it centers around an increasing or
decreasing line, like that in the plot above, suggests the presence of a
time trend.

**Seasonality** is another characteristic of time series data that can
be visually identified in time series plots. Seasonality occurs when
time series data exhibits regular and predictable patterns at time
intervals that are smaller than a year.

**Decomposition** is often used to remove the seasonal effect from a
time series. It provides a cleaner way to understand trends. We need to
remove the seasonality from the time series.

```{r}
ts1.dcp <- stl(ts1, s.window = 'periodic')
plot(ts1.dcp)
```

**Stationarity**

A common assumption in many time series techniques is that the data are
stationary. A stationary process has the property that the ***mean,
variance and autocorrelation structure do not change over time***.
Stationarity can be defined in precise mathematical terms, but for our
purpose we mean a flat looking series, without trend, constant variance
over time, a constant autocorrelation structure over time and no
periodic fluctuations (seasonality).\
Stationarity can be determined from a run sequence plot.\

**Transformations to Achieve Stationarity**

If the time series is not stationary, we can often transform it to
stationarity with one of the following techniques. We can difference the
data. That is, given the series Zt, we create the new series
$$Y_{i}=Z_{i}âˆ’Z_{i-1}.$$\
